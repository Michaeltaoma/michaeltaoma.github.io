<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />


	<title>M1 Mac Install risc-v, qemu and xv6 · Tao Ma</title>


<meta name="description" content="为了尝试做6.S081 (Introduction to Operating Systems)的lab, 需要配置risc-v, qemu, xv6.">

<link rel="icon" href="http://localhost:4000/assets/favicon.png">
<link rel="apple-touch-icon" href="http://localhost:4000/assets/touch-icon.png">
<link rel="stylesheet" href="http://localhost:4000/assets/core.css">
<link rel="canonical" href="http://localhost:4000/m1-mac-install-risc-v-xv6">
<link rel="alternate" type="application/atom+xml" title="Tao Ma" href="http://localhost:4000/feed.xml" />


<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


	</head>

	<body>

		<!--<div style="background-image: url('https://source.unsplash.com/random/360x175');">-->
<!--<div style="background-color: #7BA7AB">-->
<style>

.d-flex {
	position: relative;
	/*background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);*/
	/*background: linear-gradient(-45deg, #134e5e, #71b280);*/
	/*background: linear-gradient(54deg, #260032, #D8186E);*/
	background-size: 400% 400%;
	animation: gradient 10s ease infinite;
	height: 160px;
	width: 100%;
	border-radius: 10px;
}
	input{
		border: 1px solid #ccc;
		width: 30%;
		border-radius: 3px;
		padding: 7px 0px 7px 5px;
		-webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
		box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
		-webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
		-o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
		transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s
            }
	input:focus{
		border-color: #66afe9;
		outline: 0;
		-webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);
		box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)
	}
	#search-container ul {
		list-style: none;
		}
	#search-container ul li::before {
	  content: "";
	  background-image: url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/3/fb-heart.gif);
	  background-size: contain;
	  display: inline-block;
	  width: 1em;
	  height: 1em;
	  position: relative;
	  top: 0.1rem;
	  margin-right: 0.2rem;
	}

	@keyframes gradient {
	0% {
		background-position: 0% 50%;
	}
	50% {
		background-position: 100% 50%;
	}
	100% {
		background-position: 0% 50%;
	}
}
</style>


<div class="d-flex ">
	<div class="logo">

		

		<a href="http://localhost:4000/">
<!--			<img src="https://source.unsplash.com/random/460x460" alt="" class="logo-avatar">-->
			<!-- <img src="assets/post_pics/head_icon.jpeg" alt="" class="logo-avatar"> -->
			<img src="assets/post_pics/agB31P6_700bwp.jpg" alt="" class="logo-avatar">

		</a>
		<span class="logo-prompt code">Main</span>
	</div>
<br />

</div>

<br />

<section>
	And hello to u too:) Click the icon above for more detail

	<br />
	<br />

	<div id="search-container" >
		<input type="text" id="search-input" placeholder="search">
		<ul id="results-container"></ul>
	</div>


<!-- Script pointing to search-script.js -->
	<script src="assets/js/search-script.js" type="text/javascript"></script>

<!-- Configuration -->
	<script>
	SimpleJekyllSearch({
  		searchInput: document.getElementById('search-input'),
  		resultsContainer: document.getElementById('results-container'),
  		json: '/search.json'
	})
	</script>

</section>




		<div id="content">
			<article>

	<div class="center">
		<h1 class="title">M1 Mac Install risc-v, qemu and xv6</h1>
		<time class="code">April 20, 2022</time>
	</div>

	<div class="divider"></div>

	<p>为了尝试做<a href="https://pdos.csail.mit.edu/6.S081/2020/">6.S081 (Introduction to Operating Systems)</a>的lab, 需要配置<code>risc-v, qemu, xv6</code>.</p>

<h4 id="我的电脑配置">我的电脑配置</h4>
<ul>
  <li>MacBook Pro (16-inch, 2021)</li>
  <li>macOS Monterey, version = 12.3.1</li>
</ul>

<h4 id="配置全指南">配置全指南</h4>
<ul>
  <li>在开始之前，先检查一下自己的<code>~/.bash_profile, ~/.zshrc</code>等配置文件有没有export一些奇奇怪怪的flag，如果有的话请尽快删除以免影响配置</li>
  <li>很多人已经写出了很全面的教程，这里只是为了address一些貌似只有我遇到过的问题，需要完整的配置教程的话，点开<a href="#参考">参考</a>下的文章（按照”于我”有用的程度从上到下排序）
    <h4 id="steps">Steps</h4>
    <h5 id="risc-v-toolchain">Risc-V toolchain</h5>
  </li>
  <li>如果不想自己编译/编译<code>risc-v</code>出bug的话，可以直接从别人那里下载编译好的版本，见<a href="#参考">参考</a></li>
  <li>我用的是<a href="https://cloud.tencent.com/developer/article/1939023">MIT 6.S081/Fall 2020 搭建risc-v与xv6开发调试环境</a>的预编译版本，直接再设置个link就可以了</li>
  <li>Test: <code class="language-plaintext highlighter-rouge">riscv64-unknown-elf-gcc -v</code>
    <h6 id="riscv64-unknown-elf-gdb">riscv64-unknown-elf-gdb</h6>
  </li>
  <li><strong>注意</strong>：在<code class="language-plaintext highlighter-rouge">riscv64-unknown-elf-gcc -v</code>能用，<code class="language-plaintext highlighter-rouge">qemu</code>配置完成（能在xv6的路径下<code class="language-plaintext highlighter-rouge">make qemu</code>）之前都不要看这个，这一步是为了测试使用<code class="language-plaintext highlighter-rouge">qemu-gdb</code>对<code class="language-plaintext highlighter-rouge">xv6</code>进行调试的可行性</li>
  <li>需要注意的是，这个预编译版本下的<code class="language-plaintext highlighter-rouge">riscv64-unknown-elf-gdb</code>不work，报一个类似<code class="language-plaintext highlighter-rouge">an incompatible architecture (have '', need 'arm64e')</code>的错误，应该是版本兼容的问题。</li>
  <li>所以我只能下载<a href="https://zhayujie.com/mit6828-env.html#comment-187">MIT6.828准备 — risc-v和xv6环境搭建</a>下的<code class="language-plaintext highlighter-rouge">riscv64-unknown-elf-gdb == 8.3.0</code>预编译版本，提高权限，打开权限，这时报了另一个错
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Could not load the Python gdb module from 
  /usr/local/opt/riscv-gnu-toolchain/share/gdb/python'
</code></pre></div>    </div>
  </li>
  <li>所以只能尝试把别的gdb distribution下的python复制过来，比如可以把brew的gdb下的python挪过来:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cp -R /usr/local/Cellar/gdb/10.1/share/gdb/python /usr/local/opt/riscv-gnu-toolchain/share/gdb/python/
</code></pre></div>    </div>
    <p>这时执行<code class="language-plaintext highlighter-rouge">souce .gdbinit</code>可能会有两种可能：</p>
    <ul>
      <li>配置成功！(显示<code class="language-plaintext highlighter-rouge">0x0000000000001000 in ?? ()</code>)
        <ul>
          <li>配置失败 (不显示以上内容，或者直接报错):
            <ul>
              <li>失败的原因千千万，对我而言是这样：
                <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Python Exception &lt;type 'exceptions.NameError'&gt; Installation error: gdb.execute_unwinders function is missing:
</code></pre></div>                </div>
                <p>明白了，放进去的python并不是<code class="language-plaintext highlighter-rouge">riscv64-unknown-elf-gdb == 8.3.0</code>想要的python，那就换一个python的版本测试下，对我而言能用的版本是<code>RISC-V toolchain == 10.2.0</code>的<code class="language-plaintext highlighter-rouge">intel</code>预编译版本的python:</p>
                <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>riscv-gnu-toolchain/share/gdb/python
</code></pre></div>                </div>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h5 id="qemu">QEMU</h5>
<ul>
  <li>我参考的是<a href="https://github.com/BASARANOMO/xv6-labs-2020/issues/1">Install riscv-tools and qemu on Apple Silicon M1 mac #1</a>，在打补丁的时候，我使用的是<code class="language-plaintext highlighter-rouge">git apply *.patch</code>而不是<code class="language-plaintext highlighter-rouge">patch -p1 *.patch</code>.</li>
</ul>

<h5 id="xv6">XV6</h5>
<ul>
  <li>具体就看你想要的是哪个版本的课了，我用的是2022版本的</li>
  <li><code class="language-plaintext highlighter-rouge">git clone https://github.com/mit-pdos/xv6-riscv.git</code></li>
</ul>

<h5 id="参考">参考</h5>

<h6 id="mit6828准备--risc-v和xv6环境搭建"><a href="https://zhayujie.com/mit6828-env.html#comment-187">MIT6.828准备 — risc-v和xv6环境搭建</a></h6>
<ul>
  <li>包含<code>RISC-V toolchain == 9.2.0</code>的源码，需要自己编译，详情看帖子</li>
  <li>包含<code class="language-plaintext highlighter-rouge">riscv64-unknown-elf-gdb == 8.3.0</code>的版本，需要自己提高权限+开启权限, 详情看帖子</li>
</ul>

<h6 id="mit-6s081fall-2020-搭建risc-v与xv6开发调试环境"><a href="https://cloud.tencent.com/developer/article/1939023">MIT 6.S081/Fall 2020 搭建risc-v与xv6开发调试环境</a></h6>
<ul>
  <li>包含<code>RISC-V toolchain == 10.2.0</code>的<code class="language-plaintext highlighter-rouge">intel</code>和<code class="language-plaintext highlighter-rouge">m1</code>的预编译，可以直接使用，详情看帖子</li>
</ul>

<h6 id="install-riscv-tools-and-qemu-on-apple-silicon-m1-mac-1"><a href="https://github.com/BASARANOMO/xv6-labs-2020/issues/1">Install riscv-tools and qemu on Apple Silicon M1 mac #1</a></h6>
<ul>
  <li>包含需要打在<code class="language-plaintext highlighter-rouge">qemu</code>上的两个补丁，先打补丁，再<code class="language-plaintext highlighter-rouge">configure</code>，再<code class="language-plaintext highlighter-rouge">make</code>，再<code class="language-plaintext highlighter-rouge">make install</code></li>
</ul>



</article>

<div class="page-navigation code">
	
    <a class="next" href="http://localhost:4000/leetcode" title="NEXT: Leetcode">&lt;&lt;</a>
		<span> &middot; </span>
  
		<a class="home" href="http://localhost:4000/" title="Back to Index">Index</a>
  
		<span> &middot; </span>
    <a class="prev" href="http://localhost:4000/blockchain-note" title="PREV: Blockchain Note">&gt;&gt;</a>
  
</div>

<!-- Link Gitalk 的支持文件  -->
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> 
<script type="text/javascript" src="/assets/js/md5.min.js"></script>
<div id="gitalk-container"></div>     
<script type="text/javascript">
    var gitalk = new Gitalk({
    // gitalk的主要参数
        clientID: 'f075f01270dae871aa15',
        clientSecret: '5a97f06edaad9527cb4a92d6d1ee12a86ec73057',
        repo: 'michaeltaoma.github.io',
        owner: 'michaeltaoma',
        admin: ['michaeltaoma'],
        id: md5(location.pathname),
        
    });
    gitalk.render('gitalk-container');
</script> 
<!-- Gitalk end -->


		</div>

		<div class="footer">
  <span class="block">&copy; 2022 Tao Ma</span>
  <!-- <span class="block"><small>&lt;/&gt; Powered by <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://github.com/heiswayi/the-plain">The Plain theme</a>.</small></span> -->
</div>


	</body>

</html>
